{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-center mt-5">
  <div style="max-width: 600px;">
    {% if review.image %}
      <img src="{{ review.image.url }}" style="width: 600px; height: auto;" alt="IMAGE">
    {% else %}
      <p>ì´ë¯¸ì§€ ì—†ìŒ</p>
    {% endif %}
    <div class="mt-3">
      <p><span class="fw-bold">ì‘ì„±ì</span> - {{review.user}}</p>
      <p><span class="fw-bold">í›„ê¸° ë²ˆí˜¸</span> - {{review.pk}}</p>
      <p><span class="fw-bold">í›„ê¸° ì œëª©</span> - {{review.title}}</p>
      <p class="text-break"><span class="fw-bold">í›„ê¸° ë‚´ìš©</span> - {{review.content}}</p>
      <p><span class="fw-bold">ì˜í™” ì´ë¦„</span> - {{review.movie}}</p>
    </div>

    <div class="mt-2">
      {% if request.user == review.user %}
        
        <a class="btn btn-outline-success" href="{% url 'reviews:update' review.pk %}">UPDATE</a>
      {% endif %}
        <a class="btn btn-outline-secondary" href="{% url 'reviews:index' %}">back</a>
    </div>
    {% if request.user == review.user %}
      <form action="{% url 'reviews:delete' review.pk  %}" method="POST">
        {% csrf_token %}
        {% comment %} <input class="btn btn-outline-danger mt-2" type="submit" value="ê²Œì‹œê¸€ ì‚­ì œ"> {% endcomment %}
        <button type="submit" class="btn btn-outline-danger mt-2">ê²Œì‹œê¸€ ì‚­ì œ</button>
      </form>
    {% endif %}
    
    <hr>

    <form action="{% url 'reviews:comment_create' review.pk %}" method="post">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <input class="btn btn-outline-secondary btn-sm" type="submit" value="âœğŸ»ëŒ“ê¸€ ì‘ì„±">
    </form>
    <hr>
    <p class="p-3 fw-bold mb-2 bg-body-secondary">ëŒ“ê¸€ <span style="color:#00c3bd;">{{count}}</span></p>
    {% for comment in comments %}
      <div>
        <p class="fw-bold">{{ comment.user }}</p>
        <p>ëŒ“ê¸€ ë²ˆí˜¸ - {{ comment.pk}}</p>
        <p class="text-break">ëŒ“ê¸€ ë‚´ìš© - {{ comment.content}}</p>
        {% if request.user == comment.user %}
        <div class="d-flex flex-row">
          <div id="button-container-{{ comment.pk }}">
            <button id="comment_btn_{{ comment.pk }}" class="btn btn-outline-warning btn-sm me-2">ëŒ“ê¸€ ìˆ˜ì •</button>
            <div id="dis_{{ comment.pk }}" style="display: none;">
              <form action="{% url 'reviews:comment_update' review.pk comment.pk %}" method="POST">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" value="UPDATE" class="btn btn-outline-warning btn-sm">ëŒ“ê¸€ ìˆ˜ì •</button>
              </form>
            </div>
          </div>
          <form action="{% url 'reviews:comment_delete' review.pk comment.pk %}" method="POST">
            {% csrf_token %}
            <input class="btn btn-outline-danger btn-sm" type="submit" value="ëŒ“ê¸€ ì‚­ì œ">
          </form>
        </div>
        {% endif %}
      </div>
      <hr>
    {% endfor %}
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
$(document).ready(function() {
  $("[id^='button-container-']").on("click", "[id^='comment_btn_']", function() {
    var btn_id = $(this).attr('id');
    var dis_id = "#dis_" + btn_id.split("_")[2];
    if($(dis_id).css('display') == 'none'){
      $(dis_id).show();
      $(this).text('ëŒ“ê¸€ ìˆ˜ì • ì·¨ì†Œ');
    }else{
      $(dis_id).hide();
      $(this).text('ëŒ“ê¸€ ìˆ˜ì •');
    }
  });
});
</script>
{% endblock content %}